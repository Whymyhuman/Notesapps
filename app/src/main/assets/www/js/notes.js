document.addEventListener('DOMContentLoaded',()=>{let e=document.getElementById("note-input"),t=document.getElementById("add-btn"),n=document.getElementById("notes-list"),o=document.getElementById("stats"),i=document.getElementById("export-btn"),a=document.getElementById("import-input"),d=document.getElementById("clear-all-btn"),l=JSON.parse(localStorage.getItem("notes-app-data")||"[]"),r=null;const s=()=>{localStorage.setItem("notes-app-data",JSON.stringify(l))},c=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),p=()=>{n.innerHTML="",0===l.length?n.innerHTML='<div class="empty-state"><h3>Belum ada catatan.</h3></div>':l.forEach((e,t)=>{const o=document.createElement("div");o.className="note-item",o.innerHTML=`<div class="note-text">${c(e.text)}</div><div class="note-date">Dibuat: ${new Date(e.date).toLocaleString("id-ID")}</div><div class="note-actions"><button class="btn btn-small btn-edit" data-index="${t}">✏️ Edit</button><button class="btn btn-small btn-delete" data-index="${t}">🗑️ Hapus</button></div>`,n.appendChild(o)}),(()=>{const e=l.length,t=l.reduce((e,t)=>e+t.text.length,0);o.textContent=`📊 Total: ${e} catatan • ${t} karakter`})()};const m=()=>{const n=e.value.trim();n&&(null!==r?(l[r].text=n,r=null,t.textContent="Tambah Catatan"):l.unshift({text:n,date:(new Date).toISOString()}),e.value="",s(),p(),e.focus())};t.addEventListener("click",m),n.addEventListener("click",n=>{const o=n.target.dataset.index;n.target.classList.contains("btn-delete")?confirm("Hapus catatan ini?")&&(l.splice(o,1),s(),p()):n.target.classList.contains("btn-edit")&&(e.value=l[o].text,r=o,t.textContent="Update Catatan",e.focus(),window.scrollTo({top:0,behavior:"smooth"}))}),i.addEventListener("click",()=>{if(0===l.length)return alert("Tidak ada catatan untuk diekspor.");const e=JSON.stringify(l,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.download=`notes-backup-${(new Date).toISOString().slice(0,10)}.json`,o.href=n,o.click(),URL.revokeObjectURL(n)}),a.addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=JSON.parse(e.target.result);Array.isArray(t)?confirm(`Impor ${t.length} catatan?`)&&(l=[...t,...l],s(),p()):alert("File JSON tidak valid.")}catch(e){alert("Gagal membaca file.")}},n.readAsText(t),a.value=""}),d.addEventListener("click",()=>{l.length>0&&confirm("HAPUS SEMUA CATATAN?")&&(l=[],r=null,t.textContent="Tambah Catatan",e.value="",s(),p())}),p()});
